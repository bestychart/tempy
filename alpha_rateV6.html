<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Alpha Analysis Dashboard</title>
    <style>
        :root {
            --bg: #0b0e11;
            --card: #1e2329;
            --text: #eaecef;
            --sub: #848e9c;
            --green: #0ecb81;
            --red: #f6465d;
            --gold: #fcd535;
            --blue: #3291ff;
            --hover: #2b3139;
            --border: #2b3139;
            --tag-bg: #2b3139;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 600; }
        h1 span { color: var(--gold); }
        
        .stats { 
            color: var(--sub); 
            font-size: 14px; 
            background: var(--card); 
            padding: 6px 12px; 
            border-radius: 6px; 
            border: 1px solid var(--border);
        }

        #statusMessage {
            text-align: center;
            padding: 40px;
            color: var(--sub);
            font-size: 16px;
        }
        .error { color: var(--red); }

        .table-wrap {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            overflow-x: auto;
        }

        table { width: 100%; border-collapse: collapse; white-space: nowrap; font-size: 13px; }

        thead { background: #2b3139; position: sticky; top: 0; z-index: 10; }
        
        th {
            padding: 16px 15px;
            text-align: right;
            color: var(--sub);
            font-weight: 600;
            /* –ó–º—ñ–Ω–µ–Ω–æ –∑ pointer –Ω–∞ default, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ */
            cursor: default; 
            user-select: none;
            transition: color 0.2s, background 0.2s;
        }
        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –µ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–Ω—è */
        th:hover { color: var(--sub); background: #2b3139; }
        th:first-child { text-align: left; padding-left: 24px; }
        th.active { color: var(--gold); }
        
        td {
            padding: 14px 15px;
            border-bottom: 1px solid var(--border);
            text-align: right;
            vertical-align: middle;
        }
        td:first-child { text-align: left; padding-left: 24px; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: var(--hover); }

        /* Column Specifics */
        .token-wrapper { display: flex; flex-direction: column; gap: 6px; }
        .token-header { display: flex; align-items: center; gap: 8px; }
        .token-name { font-weight: 700; font-size: 15px; color: var(--text); }
        
        .link-icon {
            color: var(--sub);
            text-decoration: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            transition: color 0.2s;
            opacity: 0.7;
        }
        .link-icon:hover { color: var(--blue); opacity: 1; }

        .token-meta { font-size: 11px; color: var(--sub); display: flex; flex-direction: column; gap: 2px;}
        .meta-row { display: flex; gap: 6px; align-items: center; opacity: 0.8; }

        /* Market Tags */
        .market-row { display: flex; gap: 6px; margin-top: 2px; }
        .m-tag {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            background: var(--tag-bg);
            color: var(--sub);
            border: 1px solid #3d4550;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .m-tag.active {
            color: var(--text);
            border-color: #5e6673;
            background: #363c45;
        }
        .lag-val {
            color: var(--gold);
            font-weight: 400;
            font-size: 9px;
            opacity: 0.9;
        }

        /* Values */
        .val { font-family: 'Consolas', 'Monaco', monospace; font-weight: 600; font-size: 14px; }
        .val-sub { display: block; font-size: 11px; color: var(--sub); margin-top: 2px; }

        .green { color: var(--green); }
        .red { color: var(--red); }
        .gold { color: var(--gold); }
        .blue { color: var(--blue); }

        /* Badges */
        .badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .b-sale { background: rgba(50, 145, 255, 0.15); color: var(--blue); border: 1px solid rgba(50, 145, 255, 0.3); }
        .b-drop { background: rgba(14, 203, 129, 0.15); color: var(--green); border: 1px solid rgba(14, 203, 129, 0.3); }
        .b-delisted { background: rgba(246, 70, 93, 0.15); color: var(--red); border: 1px solid rgba(246, 70, 93, 0.3); }

        /* Days Badge - UPDATED LOGIC */
        .days-badge {
            /* –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (—è–∫—â–æ –¥–Ω—ñ–≤ > 1) - —Ç–µ–º–Ω–∏–π, –º–∞–π–∂–µ –Ω–µ–≤–∏–¥–∏–º–∏–π */
            background: #2b3139;
            color: #42efff; /* –î—É–∂–µ —Ç–µ–º–Ω–æ-—Å—ñ—Ä–∏–π, –ª–µ–¥—å –≤–∏–¥–Ω–æ –Ω–∞ —Ñ–æ–Ω—ñ */
            border: 1px solid #42efff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .days-zero { 
            /* –Ø–∫—â–æ 1 –¥–µ–Ω—å - —è—Å–∫—Ä–∞–≤–∏–π –∂–æ–≤—Ç–∏–π */
            background: rgba(252, 213, 53, 0.1); 
            color: var(--gold); 
            border: 1px solid rgba(252, 213, 53, 0.3); 
            font-weight: 700;
        }

        /* Date Info */
        .date-info { font-size: 11px; color: var(--sub); line-height: 1.4; }
        .date-label { color: #5e6673; margin-right: 4px; }
        .text-delisted { color: var(--red); margin-top: 2px; font-weight: 600; }

        /* NEW STATS COLUMN STYLES */
        .stat-box {
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 11px;
            min-width:100px;
        }
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed #323840;
            padding-bottom: 2px;
            gap: 12px;
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-title { color: #5e6673; font-weight: 600; }
        .stat-data { 
            font-family: monospace; 
            color: var(--text); 
            font-size: 14px;    /* <-- –î–æ–¥–∞–Ω–æ: 11px * 1.25 = ~14px */
            font-weight: 500;   /* <-- –†–µ–∫–æ–º–µ–Ω–¥—É—é —Ç–∞–∫–æ–∂ –¥–æ–¥–∞—Ç–∏ –∂–∏—Ä–Ω—ñ—Å—Ç—å, —â–æ–± —Ü–∏—Ñ—Ä–∏ —á—ñ—Ç–∫–æ —á–∏—Ç–∞–ª–∏—Å—å */
        }        
        .stat-sub { font-size: 9px; color: var(--sub); margin-left: 4px; }
        
        .pct-green { color: var(--green); }
        .pct-red { color: var(--red); }

        /* –§—ñ–∫—Å—É—î–º–æ —à–∏—Ä–∏–Ω—É –ø–µ—Ä—à–∏—Ö –¥–≤–æ—Ö –∫–æ–ª–æ–Ω–æ–∫ */
        th:nth-child(1), td:nth-child(1) {
            width: 16%; /* Token/Markets - –æ–±–º–µ–∂—É—î–º–æ —à–∏—Ä–∏–Ω—É */
            max-width: 150px;
        }
        
        th:nth-child(2), td:nth-child(2) {
            width: 100px; /* Listing Stats - –≤—É–∑—å–∫–∞ –∫–æ–ª–æ–Ω–∫–∞ */
            min-width: 100px;
            max-width: 180px;
        }
        
        /* –†–æ–∑–ø–æ–¥—ñ–ª—è—î–º–æ –ø—Ä–æ—Å—Ç—ñ—Ä —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ –∑ –¥–∞–Ω–∏–º–∏ (3-—Ç—è —ñ –¥–∞–ª—ñ) */
        th:nth-child(n+3), td:nth-child(n+3) {
            width: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª —Ä–µ—à—Ç–∏ –ø—Ä–æ—Å—Ç–æ—Ä—É */
        }

    </style>
</head>
<body>

<div class="header">
    <h1>Alpha <span>History</span> Dashboard</h1>
    <div class="stats" id="recordCount">Loading...</div>
</div>

<div class="table-wrap">
    <table id="mainTable">
        <thead>
            <tr>
                <th>Token / Markets</th>
                <th>Listing Stats</th>
                <th>Dates</th>
                <th>Current Value</th>
                <th>ATH Value</th>
                <th>Days to ATH</th>
                <th>ATL Value</th>
                <th>Days to ATL</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Data will be injected here -->
        </tbody>
    </table>
    <div id="statusMessage">Initializing...</div>
</div>

<script>
    // Configuration
    const JSON_FILE = 'airdrop_data.json';
    
    // State
    let tableData = [];
    let sortCol = 'dates';
    let sortAsc = false;

    // Formatters
    const fmtMoney = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
    const fmtMoneySmall = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 2 });
    const fmtPrice = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 });
    const fmtNum = new Intl.NumberFormat('en-US');

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
    });

    async function loadData() {
        const statusEl = document.getElementById('statusMessage');
        try {
            const response = await fetch(JSON_FILE);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            
            tableData = data;
            document.getElementById('recordCount').innerText = `Loaded ${tableData.length} tokens`;
            statusEl.style.display = 'none';
            
            // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: –î–∞—Ç–∏ (—Å–ø–æ—á–∞—Ç–∫—É –Ω–æ–≤—ñ)
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ª–æ–≥—ñ–∫—É —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç —è–∫ string 'YYYY-MM-DD'
            tableData.sort((a, b) => {
                const dateA = a.analysis ? a.analysis.start_date : '0000-00-00';
                const dateB = b.analysis ? b.analysis.start_date : '0000-00-00';
                // –°–ø–∞–¥–∞–Ω–Ω—è (Desc): b > a
                if (dateB > dateA) return 1;
                if (dateB < dateA) return -1;
                return 0;
            });

            renderTable(); // –ü—Ä–æ—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏–º–æ, –±–µ–∑ applySort
        } catch (error) {
            console.error('Error loading JSON:', error);
            statusEl.innerHTML = `<span class="error">Failed to load <b>${JSON_FILE}</b>.<br><br>Use a local server or check file path.</span>`;
        }
    }



    function fmtPct(val) {
        if (val === undefined || val === null) return 'N/A';
        const num = parseFloat(val);
        const cls = num >= 0 ? 'pct-green' : 'pct-red';
        const sign = num >= 0 ? '+' : '';
        return `<span class="${cls}">${sign}${num.toFixed(1)}%</span>`;
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';

        tableData.forEach(row => {
            const tr = document.createElement('tr');
            const hasData = !!row.analysis;
            
            // --- 1. Info / Markets ---
            const hasLink = row.link && row.link !== "NO_LINK" && row.link !== "N/A";
            const linkHtml = hasLink ? `<a href="${row.link}" target="_blank" class="link-icon">üîó</a>` : '';
            
            let badgeHtml = '';
            if (row.status === 'Delisted') badgeHtml = `<span class="badge b-delisted">DELISTED</span>`;
            else if (row.type === 'Sale') badgeHtml = `<span class="badge b-sale">SALE</span>`;
            else badgeHtml = `<span class="badge b-drop">AIRDROP</span>`;

            // Market Tags
            let marketsHtml = '';
            if (row.markets_availability) {
                const mkts = row.markets_availability;
                const lags = row.listing_lags || {};
                marketsHtml += `<div class="market-row">`;
                if (mkts.spot) {
                    let lagTxt = '';
                    if (lags.alpha_to_spot_days > 0) lagTxt = `<span class="lag-val">(+${lags.alpha_to_spot_days}d)</span>`;
                    marketsHtml += `<span class="m-tag active">SPOT ${lagTxt}</span>`;
                }
                if (mkts.futures) {
                    let lagTxt = '';
                    if (lags.alpha_to_futures_days > 0) lagTxt = `<span class="lag-val">(+${lags.alpha_to_futures_days}d)</span>`;
                    marketsHtml += `<span class="m-tag active">FUTURES ${lagTxt}</span>`;
                }
                marketsHtml += `</div>`;
            }

            let metaHtml = `<div class="token-meta">
                <div>${fmtNum.format(row.amount)} units</div>`;
            if (row.points && row.points !== "0") metaHtml += `<div class="meta-row">Pts: ${row.points}</div>`;
            if (row.slots) metaHtml += `<div class="meta-row">Slots: ${row.slots}</div>`;
            metaHtml += `</div>`;

            tr.innerHTML += `<td>
                <div class="token-wrapper">
                    <div class="token-header">
                        <span class="token-name">${row.token}</span>
                        ${linkHtml}
                        ${badgeHtml}
                    </div>
                    ${marketsHtml}
                    ${metaHtml}
                </div>
            </td>`;

            // --- 2. NEW: Listing Stats ---
            let statsHtml = `<div class="stat-box">`;
            const analytics = row.listing_analytics;

            if (analytics) {
                // Alpha First Day
                if (analytics.alpha_first_day) {
                    const afd = analytics.alpha_first_day;
                    statsHtml += `<div class="stat-row">
                        <span class="stat-title">Alpha 1st Val:</span>
                        <span class="stat-data">${fmtMoney.format(afd.min_drop_value)} - ${fmtMoney.format(afd.max_drop_value)}</span>
                    </div>`;
                }

                // Spot Comparison
                if (analytics.spot_comparison) {
                    const sc = analytics.spot_comparison;
                    if (sc.status === 'same_day') {
                        // –ó–ú–Ü–ù–ê: –†–∞—Ö—É—î–º–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å –¥—Ä–æ–ø—É (—Ü—ñ–Ω–∞ * –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
                        const minVal = sc.listing_min_price * row.amount;
                        const maxVal = sc.listing_max_price * row.amount;
                        
                        statsHtml += `<div class="stat-row">
                            <span class="stat-title">Spot List Val:</span>
                            <span class="stat-data">${fmtMoney.format(minVal)} - ${fmtMoney.format(maxVal)}</span>
                        </div>`;
                    } else if (sc.status === 'delayed') {
                        // –ó–ú–Ü–ù–ê: –ó–∞–ª–∏—à–µ–Ω–æ —Ç—ñ–ª—å–∫–∏ –º–∞–∫—Å. –∑–º—ñ–Ω—É
                        statsHtml += `<div class="stat-row">
                            <span class="stat-title">Spot vs Alpha:</span>
                            <span class="stat-data">${fmtPct(sc.max_price_change_percent)}</span>
                        </div>`;
                    }
                }

                // Futures Comparison
                if (analytics.futures_comparison) {
                    const fc = analytics.futures_comparison;
                    if (fc.status === 'same_day') {
                        // –ó–ú–Ü–ù–ê: –†–∞—Ö—É—î–º–æ –≤–∞—Ä—Ç—ñ—Å—Ç—å –¥—Ä–æ–ø—É (—Ü—ñ–Ω–∞ * –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
                        const minVal = fc.listing_min_price * row.amount;
                        const maxVal = fc.listing_max_price * row.amount;

                        statsHtml += `<div class="stat-row">
                            <span class="stat-title">Fut List Val:</span>
                            <span class="stat-data">${fmtMoney.format(minVal)} - ${fmtMoney.format(maxVal)}</span>
                        </div>`;
                    } else if (fc.status === 'delayed') {
                         // –ó–ú–Ü–ù–ê: –ó–∞–ª–∏—à–µ–Ω–æ —Ç—ñ–ª—å–∫–∏ –º–∞–∫—Å. –∑–º—ñ–Ω—É
                         statsHtml += `<div class="stat-row">
                            <span class="stat-title">Fut vs Alpha:</span>
                            <span class="stat-data">${fmtPct(fc.max_price_change_percent)}</span>
                        </div>`;
                    }
                }
            } else {
                statsHtml += `<span style="color:#444">-</span>`;
            }
            statsHtml += `</div>`;
            tr.innerHTML += `<td>${statsHtml}</td>`;


            // --- 3. Dates ---
            let dateHtml = '';
            if (hasData) {
                const dropDate = (row.input_date && row.input_date !== 'Unknown') ? row.input_date : 'N/A';
                dateHtml = `<div class="date-info">
                    <div><span class="date-label">Drop:</span>${dropDate}</div>
                    <div><span class="date-label">Start:</span>${row.analysis.start_date}</div>
                </div>`;
                if (row.status === 'Delisted' && row.delisted_date) {
                    dateHtml += `<div class="date-info text-delisted">Ended: ${row.delisted_date}</div>`;
                }
            } else {
                dateHtml = '<span class="val-sub">No Data</span>';
            }
            tr.innerHTML += `<td>${dateHtml}</td>`;

            // --- 4. Prices / Days ---
            if (hasData) {
                const a = row.analysis;
                tr.innerHTML += `<td><div class="val blue">${fmtMoney.format(a.current_value)}</div><span class="val-sub">@ ${fmtPrice.format(a.current_price)}</span></td>`;
                tr.innerHTML += `<td><div class="val green">${fmtMoney.format(a.ath_value)}</div><span class="val-sub">@ ${fmtPrice.format(a.ath_price)}</span></td>`;
                
                // Days Logic - ATH
                const athDays = a.days_to_ath;
                const athCls = athDays === 0 ? 'days-zero' : 'days-badge'; // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π 'days-badge' –¥–ª—è > 0
                const athTxt = athDays === 0 ? 'Day 1' : `${athDays} days`;
                tr.innerHTML += `<td><span class="${athCls}">${athTxt}</span></td>`;
                
                tr.innerHTML += `<td><div class="val red">${fmtMoney.format(a.atl_value)}</div><span class="val-sub">@ ${fmtPrice.format(a.atl_price)}</span></td>`;
                
                // Days Logic - ATL
                const atlDays = a.days_to_atl;
                const atlCls = atlDays === 0 ? 'days-zero' : 'days-badge';
                const atlTxt = atlDays === 0 ? 'Day 1' : `${atlDays} days`;
                tr.innerHTML += `<td><span class="${atlCls}">${atlTxt}</span></td>`;

            } else {
                tr.innerHTML += `<td colspan="5" style="text-align:center; color:var(--sub); font-style:italic;">No market data</td>`;
            }

            tbody.appendChild(tr);
        });
    }
</script>

</body>
</html>